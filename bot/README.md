# Telegram-бот для трекера подписок

Бот уведомляет за 2 дня до списания и позволяет просматривать, добавлять и удалять подписки из Telegram. Данные синхронизируются с тем же Firebase, что и веб-приложение.

## Возможности

- **Уведомления** — за 2 дня до даты списания бот присылает напоминание (ежедневная проверка в 9:00 по локальному времени).
- **Список подписок** — команда `/list` выводит все подписки в хронологическом порядке (от ближайшего списания к дальнему).
- **Добавление** — команда `/add` запускает пошаговый ввод: название, цена, валюта, дата следующего списания, период (monthly/yearly).
- **Удаление** — команда `/delete` показывает список с кнопками или можно отправить `/delete_3` (номер из списка).
- **Привязка** — в веб-приложении нажмите «Привязать Telegram», получите код и отправьте боту: `/link_КОД`.

## Установка

1. Создайте бота в Telegram через [@BotFather](https://t.me/BotFather), получите токен.

2. В [Firebase Console](https://console.firebase.google.com/) → Настройки проекта → Служебные учетные записи → «Создать закрытый ключ». Сохраните JSON-файл в папку `bot/` как `service-account.json` (или укажите путь в переменной окружения).

3. Обновите правила Firestore: добавьте правило для коллекции `link_codes` (см. основной `FIREBASE_SETUP.md` в корне проекта).

4. В папке `bot/` создайте файл `.env` по образцу `.env.example`:

```bash
cp .env.example .env
```

Заполните в `.env`:

- `TELEGRAM_BOT_TOKEN` — токен от BotFather.
- `GOOGLE_APPLICATION_CREDENTIALS` — путь к `service-account.json` (например `./service-account.json`).

Либо вместо файла можно задать переменную `FIREBASE_SERVICE_ACCOUNT_JSON` — строка с содержимым JSON сервисного аккаунта.

5. Установите зависимости и запустите:

```bash
cd bot
npm install
npm start
```

Для уведомлений бот должен работать постоянно (сервер, VPS или облачная функция с расписанием).

## Команды бота

| Команда | Описание |
|--------|----------|
| `/start` | Приветствие и подсказки |
| `/link_КОД` | Привязать чат к аккаунту (код из веб-приложения) |
| `/list` | Список подписок по дате списания |
| `/add` | Добавить подписку (пошаговый ввод) |
| `/delete` | Удалить подписку (выбор из списка) |
| `/delete_НОМЕР` | Удалить подписку по номеру из списка (например `/delete_3`) |

## Безопасность

- Файл `service-account.json` и переменные из `.env` не должны попадать в репозиторий. Добавьте в `.gitignore`: `bot/.env`, `bot/service-account.json`.
